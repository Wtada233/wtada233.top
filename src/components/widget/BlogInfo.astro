---
import Icon from "@components/common/Icon.astro";
import WidgetLayout from "@components/widget/WidgetLayout.astro";
import { blogInfoConfig } from "@configs/blog-info";
import { siteConfig } from "@configs/site";
import I18nKey from "@i18n/i18nKey";
import { i18n } from "@i18n/translation";
import { getBlogStats } from "@utils/content-utils";
import { getLangFromPathname } from "@utils/i18n-runtime";

const statsMap = await getBlogStats();

interface Props {
	class?: string;
	style?: string;
}
const { class: className, style } = Astro.props;

// Get current lang from URL
const lang = getLangFromPathname(Astro.url.pathname);
const stats = statsMap[lang] || statsMap[siteConfig.lang];
---

{blogInfoConfig.enabled && (
<WidgetLayout i18nKey={I18nKey.blogInfo} isI18nName={true} id="blog-info" class={className} style={style}>
    <div class="flex flex-col gap-2 text-sm text-gray-600 dark:text-gray-400 translation-unit">
        {blogInfoConfig.showTotalArticles && (
        <div class="flex items-center justify-between">
            <span class="flex items-center gap-2">
                <Icon name="material-symbols:article-outline" class="text-lg"></Icon>
                {i18n(I18nKey.totalArticles, {}, lang)}:
            </span>
            <span class="font-bold text-gray-800 dark:text-gray-200">{stats?.totalArticles}</span>
        </div>
        )}
        {blogInfoConfig.showTotalSeries && (
        <div class="flex items-center justify-between">
            <span class="flex items-center gap-2">
                <Icon name="material-symbols:collections-bookmark-outline" class="text-lg"></Icon>
                {i18n(I18nKey.totalSeries, {}, lang)}:
            </span>
            <span class="font-bold text-gray-800 dark:text-gray-200">{stats?.totalSeries}</span>
        </div>
        )}
        {blogInfoConfig.showTotalTags && (
        <div class="flex items-center justify-between">
            <span class="flex items-center gap-2">
                <Icon name="material-symbols:sell-outline" class="text-lg"></Icon>
                {i18n(I18nKey.totalTags, {}, lang)}:
            </span>
            <span class="font-bold text-gray-800 dark:text-gray-200">{stats?.totalTags}</span>
        </div>
        )}
        {blogInfoConfig.showTotalCategories && (
        <div class="flex items-center justify-between">
            <span class="flex items-center gap-2">
                <Icon name="material-symbols:category-outline" class="text-lg"></Icon>
                {i18n(I18nKey.totalCategories, {}, lang)}:
            </span>
            <span class="font-bold text-gray-800 dark:text-gray-200">{stats?.totalCategories}</span>
        </div>
        )}
        {blogInfoConfig.showTotalWords && (
        <div class="flex items-center justify-between">
            <span class="flex items-center gap-2">
                <Icon name="material-symbols:text-fields" class="text-lg"></Icon>
                {i18n(I18nKey.totalWords, {}, lang)}:
            </span>
            <span class="font-bold text-gray-800 dark:text-gray-200">{stats?.totalWords}</span>
        </div>
        )}
    </div>
</WidgetLayout>
)}
